package com.example.demo.service;

import java.util.List;
import java.util.NoSuchElementException;
import java.util.Optional;
import java.util.Iterator;

import org.springframework.stereotype.Service;

import com.example.demo.model.Classification;
import com.example.demo.model.Gender;
import com.example.demo.model.Message;
import com.example.demo.model.Movies;

@Service
public class MovieService {

	//Atributo 
	private List<Movies> listMovies; 
	private boolean control; 
	
	Movies HarryPoter1 = new Movies(1, "Harry Potter", 5.0, false, Gender.Fantasy, Classification.APT, 2001);
	
	Message message1 = new Message();
	
	//Constructor 
	public MovieService (List<Movies> listMovies) {
		
		this.listMovies = listMovies; 
	}

	
	//Metodo para obtener todas las peliculas
	public List<Movies> getMovies() {
		
		this.listMovies.add(HarryPoter1);
		
		return this.listMovies;
	}
	
	
	//Metodo para crear una pelicula 
	public boolean createMovie(Movies movie) {
		
		this.control = false; 
		
		Iterator <Movies> itr = this.listMovies.iterator();
		
		//Recorremos la lista
		while (itr.hasNext()) {
			
			if (itr.next().getId() == movie.getId()) {
				
				this.control = true; 
				
				break; 
			}
		}
		
		
		if (control) {
			
			return false;
			
		} else {
			
			this.listMovies.add(movie);
			
			return true; 
		}
	}
	

	//Metodo para eliminar de mi lista
	public String deleteMovie(Integer id) {
		
		this.control = false; 

		//Recorremos lalista 
		for (Movies movie : this.listMovies) {
			if (movie.getId() == id) {
				this.listMovies.remove(movie); 
				this.control = true; 
				break; 
			}
		} 
		
		if (control) return "Eliminacion exitosa";
		
		else return "Not found movie with that ID";

	}


	//Metodo para buscar una peli por id
	public Optional<Movies> getMovieById(Integer id) {
		
		Optional <Movies> mo =  null; 
		
		//Intentamos buscar nuestra pelicula. En caso de no hallar, la deja vacia 
		try {
			mo = Optional.ofNullable(this.listMovies.stream().filter(m -> m.getId() == id).findFirst().get());
			
		//En caso de que no se halle la peli solicitada, se le tira este error al usuario.
		} catch (NoSuchElementException nsee) {
			
			//this.message1.logMessage(1); -> Tiene un error.
			System.out.println("you've putted a not existent id into our data bases");
			System.out.print(nsee.getCause());
		}
		
		return mo;
	}
	
	
	//Metodo para actualizar
	
	
	
}
